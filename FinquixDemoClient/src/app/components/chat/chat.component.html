<div class="chat-container" [class.expanded]="isOpen">
    <!-- Header (always visible) -->
    <div class="chat-header" (click)="toggleChat()">
        <div class="chat-header-content">
            <span class="chat-icon">ðŸ’¬</span>
            <span class="chat-title">AI Financial Assistant</span>
        </div>
        <div class="chat-header-actions">
            <button class="chat-action-btn" *ngIf="isOpen" (click)="resetChat(); $event.stopPropagation()"
                matTooltip="Reset chat">
                <mat-icon>refresh</mat-icon>
            </button>
        </div>
    </div>

    <!-- Expanded content (only visible when open) -->
    <div class="chat-body" *ngIf="isOpen">
        <!-- Suggested questions section -->
        <div class="suggested-questions" *ngIf="questions.length > 0">
            <div class="suggested-questions-header">
                <h4>Suggested Questions</h4>
                <button mat-icon-button (click)="toggleQuestionsCollapse()" class="toggle-questions-btn">
                    <mat-icon>{{showQuestions ? 'expand_less' : 'expand_more'}}</mat-icon>
                </button>
            </div>
            <div class="question-categories" *ngIf="showQuestions">
                <div *ngFor="let category of getUniqueCategories()" class="category">
                    <h5>{{category}}</h5>
                    <div class="question-tiles">
                        <div *ngFor="let question of getQuestionsByCategory(category)" class="question-tile"
                            (click)="selectQuestion(question.text)">
                            {{question.text}}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="chat-messages">
            <div *ngFor="let msg of messages" class="message" [ngClass]="msg.type">
                <ng-container *ngIf="msg.type === 'user'">
                    <span>{{ msg.text }}</span>
                </ng-container>

                <ng-container *ngIf="msg.type === 'ai'">
                    <ng-container *ngIf="getAiAnswer(msg.text) as aiText">
                        <span>{{ aiText.summary }}</span>
                        <button *ngIf="aiText.details" (click)="toggleDetails(aiText)" class="toggle-details">
                            {{ aiText.showDetails ? 'Hide Details' : 'Show Details' }}
                        </button>
                        <div *ngIf="aiText.showDetails" class="details">
                            {{ aiText.details }}
                        </div>
                    </ng-container>
                </ng-container>
            </div>

            <div *ngIf="isLoading" class="loading">
                <mat-spinner diameter="20"></mat-spinner>
            </div>
        </div>

        <div class="chat-input">
            <input type="text" [(ngModel)]="userInput" (keyup.enter)="sendUserInput()"
                placeholder="Type your question..." />
            <button (click)="sendUserInput()" [disabled]="!userInput.trim()">
                <mat-icon>send</mat-icon>
            </button>
        </div>
    </div>
</div>