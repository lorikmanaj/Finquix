<div class="chat-container" [class.open]="isOpen">
    <div class="chat-header" (click)="toggleChat()">
        <span>ðŸ’¬ AI Financial Assistant</span>
        <button class="close-btn" *ngIf="isOpen" (click)="resetChat(); $event.stopPropagation();">ðŸ”„</button>
    </div>

    <div class="chat-body" *ngIf="isOpen">
        <div class="messages">
            <div *ngFor="let msg of messages" class="message" [ngClass]="msg.type">

                <!-- User message -->
                <ng-container *ngIf="msg.type === 'user'">
                    <span>{{ msg.text }}</span>
                </ng-container>

                <!-- AI message -->
                <ng-container *ngIf="msg.type === 'ai'">
                    <ng-container *ngIf="getAiAnswer(msg.text) as aiText">
                        <span>{{ aiText.summary }}</span>

                        <button *ngIf="aiText.details" (click)="toggleDetails(aiText)" class="toggle-details">
                            {{ aiText.showDetails ? 'Hide Details' : 'Show Details' }}
                        </button>

                        <div *ngIf="aiText.showDetails" class="details">
                            {{ aiText.details }}
                        </div>
                    </ng-container>
                </ng-container>
            </div>

            <div *ngIf="isLoading" class="loading">...</div>
        </div>

        <div class="input-container">
            <input type="text" [(ngModel)]="userInput" (keyup.enter)="sendUserInput()"
                placeholder="Type your question..." />
            <button (click)="sendUserInput()">Send</button>
        </div>
    </div>
</div>